data$age_num = data$age
levels(data$age_num) = list("5" = "[0-10)", "15" = "[10-20)", "25" = "[20-30)", "35" = "[30-40)", "45" = "[40-50)", "55" = "[50-60)", "65" = "[60-70)", "75" = "[70-80)", "85" = "[80-90)", "95" = "[90-100)")
data$age_num = as.numeric(as.character(data$age_num))
levels(data$age) = list("30 years old or younger" = c("[0-10)", "[10-20)", "[20-30)" ), "30–60 years old" = c("[30-40)", "[40-50)", "[50-60)"), "Other" = c("[60-70)", "[70-80)", "[80-90)", "[90-100)"))
data$medical_specialty <- as.factor(data$medical_specialty)
data$medical_specialty <-droplevels(data$medical_specialty)
levels(data$race) = c("African American", "Missing" ,"Other", "Caucasian")
levels(data$admission_source_id)
levels(data$medical_specialty)
levels(data$age)
levels(data$age) = c("30–60 years old", "30 years old or younger", "Other")
levels(data$diag_1)
levels(data$diag_1) = c("Diabetes", "Circulatory", "Respiratory" ,"Digestive","Injury and poisoning", "Musculoskeletal","Genitourinary","Neoplasms","Other"  )
levels(data$A1Cresult)
levels(data$A1Cresult) = c( "None", ">7", ">8", "Norm")
fit2 = glm(readmitted ~ discharge_disposition_id + race + admission_source_id + medical_specialty + time_in_hospital + age + diag_1 + A1Cresult2, family = "binomial", data = data)
summary(fit2)
fit = glm(readmitted ~ discharge_disposition_id + race + admission_source_id + medical_specialty + time_in_hospital + age + diag_1 + A1Cresult2 + age * medical_specialty +  diag_1 * discharge_disposition_id + race * discharge_disposition_id + medical_specialty*discharge_disposition_id + discharge_disposition_id*time_in_hospital + time_in_hospital*medical_specialty + age * medical_specialty + time_in_hospital*diag_1 + A1Cresult2* diag_1, family = "binomial", data = data)
summary(fit)
fit$coefficients
nrow(fit$coefficients)
dim(fit$coefficients)
dim(coefs(fit))
dim(coef(fit))
fit$coefficients
class(fit$coefficients)
length(fit$coefficients)
fit = glm(readmitted ~ discharge_disposition_id + race + admission_source_id + medical_specialty + time_in_hospital + age + diag_1 + A1Cresult2 + age * medical_specialty +  diag_1 * discharge_disposition_id + race * discharge_disposition_id + medical_specialty*discharge_disposition_id + discharge_disposition_id*time_in_hospital + time_in_hospital*medical_specialty + age * medical_specialty + time_in_hospital*diag_1 + A1Cresult* diag_1, family = "binomial", data = data)
summary(fit)
levels(data$A1Cresult)
# tables:
table(data$A1Cresult2, data$readmitted)
data$A1Cresult = as.factor(ifelse(data$A1Cresult %in% c("Norm", ">7"), "Normal", ifelse(data$A1Cresult == "None", "None", ifelse(data$change == "Ch", "high_ch", "high_noch"))))
# tables:
table(data$A1Cresult, data$readmitted)
fit = glm(readmitted ~ discharge_disposition_id + race + admission_source_id + medical_specialty + time_in_hospital + age + diag_1 + A1Cresult2 + age * medical_specialty +  diag_1 * discharge_disposition_id + race * discharge_disposition_id + medical_specialty*discharge_disposition_id + discharge_disposition_id*time_in_hospital + time_in_hospital*medical_specialty + age * medical_specialty + time_in_hospital*diag_1 + A1Cresult* diag_1, family = "binomial", data = data)
summary(fit)
levels(data$A1Cresult)
levels(data$A1Cresult) = c( "None","high_ch" ,  "high_noch" ,      "Normal" )
fit = glm(readmitted ~ discharge_disposition_id + race + admission_source_id + medical_specialty + time_in_hospital + age + diag_1 + A1Cresult2 + age * medical_specialty +  diag_1 * discharge_disposition_id + race * discharge_disposition_id + medical_specialty*discharge_disposition_id + discharge_disposition_id*time_in_hospital + time_in_hospital*medical_specialty + age * medical_specialty + time_in_hospital*diag_1 + A1Cresult* diag_1, family = "binomial", data = data)
summary(fit)
length(fit$coefficients)
summary(fit)
fit = glm(readmitted ~ discharge_disposition_id + race + admission_source_id + medical_specialty + time_in_hospital + age + diag_1 + A1Cresult  +  diag_1 * discharge_disposition_id + race * discharge_disposition_id + medical_specialty*discharge_disposition_id + discharge_disposition_id*time_in_hospital + time_in_hospital*medical_specialty + age * medical_specialty + time_in_hospital*diag_1 + A1Cresult* diag_1, family = "binomial", data = data)
summary(fit)
table(data$diag_1, data$readmitted)
data = read.csv(file = "diabetic_data.csv")
data = data[unique_id, ]
data = data[unique_id, ]
# can delete encounter_id now
data$encounter_id <- NULL
data$weight <- NULL
data$payer_code <- NULL
# 2. remove patients that entered hospice or passed away after discharge
data = data[ -which(data$discharge_disposition_id %in% c(11, 13, 14, 19, 20, 21)), ]
nrow(data)
# 69973, which is 11 less than the value reported in the paper (69984)
# re-coding:
data$readmitted = as.factor(ifelse(data$readmitted == "<30", "YES", "NO"))
data$A1Cresult
data$A1Cresult = as.factor(ifelse(data$A1Cresult %in% c("Norm", ">7"), "Normal", ifelse(data$A1Cresult == "None", "None", ifelse(data$change == "Ch", "high_ch", "high_noch"))))
data$discharge_disposition_id = as.factor(ifelse(data$discharge_disposition_id == 1, "Home", "Other"))
data$admission_source_id = as.factor(ifelse(data$admission_source_id == 7, "Emergency", ifelse(data$admission_source_id %in% c(1,2), "Referral", "Other")))
data$medical_specialty <- replace(data$medical_specialty, data$medical_specialty == "Cardiology-Pediatric", "Cardiology")
data$medical_specialty <- replace(data$medical_specialty, data$medical_specialty == "Surgeon", "SurgicalSpecialty")
data$medical_specialty <- replace(data$medical_specialty, data$medical_specialty == "Surgery-Cardiovascular/Thoracic", "SurgicalSpecialty")
data$medical_specialty <- replace(data$medical_specialty, data$medical_specialty == "Surgery-Colon&Rectal", "SurgicalSpecialty")
data$medical_specialty <- replace(data$medical_specialty, data$medical_specialty == "Surgery-General", "SurgicalSpecialty")
data$medical_specialty <- replace(data$medical_specialty, data$medical_specialty == "Surgery-Maxillofacial", "SurgicalSpecialty")
data$medical_specialty <- replace(data$medical_specialty, data$medical_specialty == "Surgery-Neuro", "SurgicalSpecialty")
data$medical_specialty <- replace(data$medical_specialty, data$medical_specialty == "Surgery-Pediatric", "SurgicalSpecialty")
data$medical_specialty <- replace(data$medical_specialty, data$medical_specialty == "Surgery-Plastic", "SurgicalSpecialty")
data$medical_specialty <- replace(data$medical_specialty, data$medical_specialty == "Surgery-PlasticwithinHeadandNeck", "SurgicalSpecialty")
data$medical_specialty <- replace(data$medical_specialty, data$medical_specialty == "Surgery-Thoracic", "SurgicalSpecialty")
data$medical_specialty <- replace(data$medical_specialty, data$medical_specialty == "Surgery-Vascular", "SurgicalSpecialty")
data$medical_specialty <- str_replace(data$medical_specialty, "SurgicalSpecialty", "Surgery")
data$medical_specialty[which(data$medical_specialty == "?")] = "Missing or Unknown"
data$medical_specialty[which(!(data$medical_specialty %in% c("InternalMedicine", "Cardiology", "Surgery", "Family/GeneralPractice", "Missing or Unknown")))] = "Other"
diag_diabetes = levels(data$diag_1)[which(substr(levels(data$diag_1), 1, 3)==250)]
diag_other = levels(data$diag_1)[which(!(levels(data$diag_1) %in% c(390:459, 785, diag_diabetes, 460:519, 786, 520:579, 787, 800:999, 710:739, 580:629, 788, 140:239)))]
levels(data$diag_1) <- list(
"Circulatory" = c(390:459, 785),
"Diabetes" = diag_diabetes,
"Respiratory" = c(460:519, 786),
"Digestive" = c(520:579, 787),
"Injury and poisoning" = c(800:999),
"Musculoskeletal" = c(710:739),
"Genitourinary" = c(580:629, 788),
"Neoplasms" = c(140:239),
"Other" = diag_other
)
levels(data$race) = list("Missing" = "?", "Other" = c("Other", "Asian", "Hispanic"), "African American" = "AfricanAmerican", "Caucasian" = "Caucasian" )
data$age_num = data$age
levels(data$age_num) = list("5" = "[0-10)", "15" = "[10-20)", "25" = "[20-30)", "35" = "[30-40)", "45" = "[40-50)", "55" = "[50-60)", "65" = "[60-70)", "75" = "[70-80)", "85" = "[80-90)", "95" = "[90-100)")
data$age_num = as.numeric(as.character(data$age_num))
levels(data$age) = list("30 years old or younger" = c("[0-10)", "[10-20)", "[20-30)" ), "30–60 years old" = c("[30-40)", "[40-50)", "[50-60)"), "Other" = c("[60-70)", "[70-80)", "[80-90)", "[90-100)"))
data$medical_specialty <- as.factor(data$medical_specialty)
data$medical_specialty <-droplevels(data$medical_specialty)
table(data$diag_1, data$readmitted)
data$race = relevel(data$race, ref = "African American")
data$age = relevel(data$age, ref = "30–60 years old")
data$diag_1 = relevel(data$diag_1, ref = "Diabetes")
data$A1Cresult =  relevel(data$A1Cresult, ref = "None")
fit = glm(readmitted ~ discharge_disposition_id + race + admission_source_id + medical_specialty + time_in_hospital + age + diag_1 + A1Cresult  +  diag_1 * discharge_disposition_id + race * discharge_disposition_id + medical_specialty*discharge_disposition_id + discharge_disposition_id*time_in_hospital + time_in_hospital*medical_specialty + age * medical_specialty + time_in_hospital*diag_1 + A1Cresult* diag_1, family = "binomial", data = data)
summary(fit)
data$age
data = data[unique_id, ]
# can delete encounter_id now
data$encounter_id <- NULL
data$weight <- NULL
data$payer_code <- NULL
# 2. remove patients that entered hospice or passed away after discharge
data = data[ -which(data$discharge_disposition_id %in% c(11, 13, 14, 19, 20, 21)), ]
nrow(data)
# 69973, which is 11 less than the value reported in the paper (69984)
# re-coding:
data$readmitted = as.factor(ifelse(data$readmitted == "<30", "YES", "NO"))
data$A1Cresult
data$A1Cresult = as.factor(ifelse(data$A1Cresult %in% c("Norm", ">7"), "Normal", ifelse(data$A1Cresult == "None", "None", ifelse(data$change == "Ch", "high_ch", "high_noch"))))
data$discharge_disposition_id = as.factor(ifelse(data$discharge_disposition_id == 1, "Home", "Other"))
data$admission_source_id = as.factor(ifelse(data$admission_source_id == 7, "Emergency", ifelse(data$admission_source_id %in% c(1,2), "Referral", "Other")))
data$medical_specialty <- replace(data$medical_specialty, data$medical_specialty == "Cardiology-Pediatric", "Cardiology")
data$medical_specialty <- replace(data$medical_specialty, data$medical_specialty == "Surgeon", "SurgicalSpecialty")
data$medical_specialty <- replace(data$medical_specialty, data$medical_specialty == "Surgery-Cardiovascular/Thoracic", "SurgicalSpecialty")
data$medical_specialty <- replace(data$medical_specialty, data$medical_specialty == "Surgery-Colon&Rectal", "SurgicalSpecialty")
data$medical_specialty <- replace(data$medical_specialty, data$medical_specialty == "Surgery-General", "SurgicalSpecialty")
data$medical_specialty <- replace(data$medical_specialty, data$medical_specialty == "Surgery-Maxillofacial", "SurgicalSpecialty")
data$medical_specialty <- replace(data$medical_specialty, data$medical_specialty == "Surgery-Neuro", "SurgicalSpecialty")
data$medical_specialty <- replace(data$medical_specialty, data$medical_specialty == "Surgery-Pediatric", "SurgicalSpecialty")
data$medical_specialty <- replace(data$medical_specialty, data$medical_specialty == "Surgery-Plastic", "SurgicalSpecialty")
data$medical_specialty <- replace(data$medical_specialty, data$medical_specialty == "Surgery-PlasticwithinHeadandNeck", "SurgicalSpecialty")
data$medical_specialty <- replace(data$medical_specialty, data$medical_specialty == "Surgery-Thoracic", "SurgicalSpecialty")
data$medical_specialty <- replace(data$medical_specialty, data$medical_specialty == "Surgery-Vascular", "SurgicalSpecialty")
data$medical_specialty <- str_replace(data$medical_specialty, "SurgicalSpecialty", "Surgery")
data$medical_specialty[which(data$medical_specialty == "?")] = "Missing or Unknown"
data$medical_specialty[which(!(data$medical_specialty %in% c("InternalMedicine", "Cardiology", "Surgery", "Family/GeneralPractice", "Missing or Unknown")))] = "Other"
diag_diabetes = levels(data$diag_1)[which(substr(levels(data$diag_1), 1, 3)==250)]
diag_other = levels(data$diag_1)[which(!(levels(data$diag_1) %in% c(390:459, 785, diag_diabetes, 460:519, 786, 520:579, 787, 800:999, 710:739, 580:629, 788, 140:239)))]
levels(data$diag_1) <- list(
"Circulatory" = c(390:459, 785),
"Diabetes" = diag_diabetes,
"Respiratory" = c(460:519, 786),
"Digestive" = c(520:579, 787),
"Injury and poisoning" = c(800:999),
"Musculoskeletal" = c(710:739),
"Genitourinary" = c(580:629, 788),
"Neoplasms" = c(140:239),
"Other" = diag_other
)
levels(data$race) = list("Missing" = "?", "Other" = c("Other", "Asian", "Hispanic"), "African American" = "AfricanAmerican", "Caucasian" = "Caucasian" )
data$age_num = data$age
levels(data$age_num) = list("5" = "[0-10)", "15" = "[10-20)", "25" = "[20-30)", "35" = "[30-40)", "45" = "[40-50)", "55" = "[50-60)", "65" = "[60-70)", "75" = "[70-80)", "85" = "[80-90)", "95" = "[90-100)")
data$age_num = as.numeric(as.character(data$age_num))
levels(data$age) = list("< 30" = c("[0-10)", "[10-20)", "[20-30)" ), "[30, 60)" = c("[30-40)", "[40-50)", "[50-60)"), "[60, 100) " = c("[60-70)", "[70-80)", "[80-90)", "[90-100)"))
data$medical_specialty <- as.factor(data$medical_specialty)
data$medical_specialty <-droplevels(data$medical_specialty)
data$race = relevel(data$race, ref = "African American")
data$age = relevel(data$age, ref = "30–60 years old")
data$diag_1 = relevel(data$diag_1, ref = "Diabetes")
data$A1Cresult =  relevel(data$A1Cresult, ref = "None")
data$race = relevel(data$race, ref = "African American")
data$age = relevel(data$age, ref = "[30, 60)")
data$diag_1 = relevel(data$diag_1, ref = "Diabetes")
data$diag_1
data = read.csv(file = "diabetic_data.csv")
data = data[unique_id, ]
# can delete encounter_id now
data$encounter_id <- NULL
data$weight <- NULL
data$payer_code <- NULL
# 2. remove patients that entered hospice or passed away after discharge
data = data[ -which(data$discharge_disposition_id %in% c(11, 13, 14, 19, 20, 21)), ]
nrow(data)
# 69973, which is 11 less than the value reported in the paper (69984)
# re-coding:
data$readmitted = as.factor(ifelse(data$readmitted == "<30", "YES", "NO"))
data$A1Cresult
data$A1Cresult = as.factor(ifelse(data$A1Cresult %in% c("Norm", ">7"), "Normal", ifelse(data$A1Cresult == "None", "None", ifelse(data$change == "Ch", "high_ch", "high_noch"))))
data$discharge_disposition_id = as.factor(ifelse(data$discharge_disposition_id == 1, "Home", "Other"))
data$admission_source_id = as.factor(ifelse(data$admission_source_id == 7, "Emergency", ifelse(data$admission_source_id %in% c(1,2), "Referral", "Other")))
data$medical_specialty <- replace(data$medical_specialty, data$medical_specialty == "Cardiology-Pediatric", "Cardiology")
data$medical_specialty <- replace(data$medical_specialty, data$medical_specialty == "Surgeon", "SurgicalSpecialty")
data$medical_specialty <- replace(data$medical_specialty, data$medical_specialty == "Surgery-Cardiovascular/Thoracic", "SurgicalSpecialty")
data$medical_specialty <- replace(data$medical_specialty, data$medical_specialty == "Surgery-Colon&Rectal", "SurgicalSpecialty")
data$medical_specialty <- replace(data$medical_specialty, data$medical_specialty == "Surgery-General", "SurgicalSpecialty")
data$medical_specialty <- replace(data$medical_specialty, data$medical_specialty == "Surgery-Maxillofacial", "SurgicalSpecialty")
data$medical_specialty <- replace(data$medical_specialty, data$medical_specialty == "Surgery-Neuro", "SurgicalSpecialty")
data$medical_specialty <- replace(data$medical_specialty, data$medical_specialty == "Surgery-Pediatric", "SurgicalSpecialty")
data$medical_specialty <- replace(data$medical_specialty, data$medical_specialty == "Surgery-Plastic", "SurgicalSpecialty")
data$medical_specialty <- replace(data$medical_specialty, data$medical_specialty == "Surgery-PlasticwithinHeadandNeck", "SurgicalSpecialty")
data$medical_specialty <- replace(data$medical_specialty, data$medical_specialty == "Surgery-Thoracic", "SurgicalSpecialty")
data$medical_specialty <- replace(data$medical_specialty, data$medical_specialty == "Surgery-Vascular", "SurgicalSpecialty")
data$medical_specialty <- str_replace(data$medical_specialty, "SurgicalSpecialty", "Surgery")
data$medical_specialty[which(data$medical_specialty == "?")] = "Missing or Unknown"
data$medical_specialty[which(!(data$medical_specialty %in% c("InternalMedicine", "Cardiology", "Surgery", "Family/GeneralPractice", "Missing or Unknown")))] = "Other"
diag_diabetes = levels(data$diag_1)[which(substr(levels(data$diag_1), 1, 3)==250)]
diag_other = levels(data$diag_1)[which(!(levels(data$diag_1) %in% c(390:459, 785, diag_diabetes, 460:519, 786, 520:579, 787, 800:999, 710:739, 580:629, 788, 140:239)))]
levels(data$diag_1) <- list(
"Circulatory" = c(390:459, 785),
"Diabetes" = diag_diabetes,
"Respiratory" = c(460:519, 786),
"Digestive" = c(520:579, 787),
"Injury and poisoning" = c(800:999),
"Musculoskeletal" = c(710:739),
"Genitourinary" = c(580:629, 788),
"Neoplasms" = c(140:239),
"Other" = diag_other
)
levels(data$race) = list("Missing" = "?", "Other" = c("Other", "Asian", "Hispanic"), "African American" = "AfricanAmerican", "Caucasian" = "Caucasian" )
data$age_num = data$age
levels(data$age_num) = list("5" = "[0-10)", "15" = "[10-20)", "25" = "[20-30)", "35" = "[30-40)", "45" = "[40-50)", "55" = "[50-60)", "65" = "[60-70)", "75" = "[70-80)", "85" = "[80-90)", "95" = "[90-100)")
data$age_num = as.numeric(as.character(data$age_num))
levels(data$age) = list("< 30" = c("[0-10)", "[10-20)", "[20-30)" ), "[30, 60)" = c("[30-40)", "[40-50)", "[50-60)"), "[60, 100) " = c("[60-70)", "[70-80)", "[80-90)", "[90-100)"))
data$medical_specialty <- as.factor(data$medical_specialty)
data$medical_specialty <-droplevels(data$medical_specialty)
data$race = relevel(data$race, ref = "African American")
data$age = relevel(data$age, ref = "[30, 60)")
data$diag_1 = relevel(data$diag_1, ref = "Diabetes")
data$A1Cresult =  relevel(data$A1Cresult, ref = "None")
fit = glm(readmitted ~ discharge_disposition_id + race + admission_source_id + medical_specialty + time_in_hospital + age + diag_1 + A1Cresult  +  diag_1 * discharge_disposition_id + race * discharge_disposition_id + medical_specialty*discharge_disposition_id + discharge_disposition_id*time_in_hospital + time_in_hospital*medical_specialty + age * medical_specialty + time_in_hospital*diag_1 + A1Cresult* diag_1, family = "binomial", data = data)
summary(fit)
data_subset = data[, c("readmitted", 'discharge_disposition_id','race' , "admission_source_id" , "medical_specialty" , "time_in_hospital" , "age" , "diag_1" , "A1Cresult")]
classtree(data = data_test, resp = "readmitted", min.obs = 100)
tree1 = classtree(data = data_test, resp = "readmitted", min.obs = 100)
tree1 = classtree(data = data_subset, resp = "readmitted", min.obs = 100)
tree1
data_subset$discharge_disposition_id
model.matrix(~. + 0, data = data_subset$discharge_disposition_id, contrasts.arg = lapply(data_subset$discharge_disposition_id, contrasts, contrasts = FALSE))
model.matrix(~ . + 0, data = data_subset$discharge_disposition_id, contrasts.arg = lapply(data_subset$discharge_disposition_id, contrasts, contrasts = FALSE))
model.matrix(~ . + 0, data = data_subset$discharge_disposition_id)
model.matrix( data = data_subset$discharge_disposition_id)
model.matrix(discharge_disposition_id ~. +0,  data = data_subset)
model.matrix(discharge_disposition_id ~. +0,  data = data_subset, contrasts.arg = lapply(data_subset$discharge_disposition_id, contrasts, contrasts = FALSE))
model.matrix(discharge_disposition_id ~. +0,  data = data_subset, contrasts.arg = lapply(data_subset, contrasts, contrasts = FALSE))
lapply(data_subset, contrasts, contrasts = FALSE)
lapply(data_subset$discharge_disposition_id, contrasts, contrasts = FALSE)
model.matrix(discharge_disposition_id ~. +0,  data = data_subset, contrasts.arg = lapply(data_subset$discharge_disposition_id, contrasts, contrasts = FALSE))
model.matrix(discharge_disposition_id ~. +0,  data = data_subset)
library(dummies)
model.matrix( ~discharge_disposition_id - 1,  data = data_subset)
head(data_subset$discharge_disposition_id)
names(discharge) = paste(leves(data_subset$discharge_disposition_id))
paste(levels(data_subset$discharge_disposition_id))
paste("discharge:", levels(data_subset$discharge_disposition_id))
names(discharge) = paste("discharge:", levels(data_subset$discharge_disposition_id))
discharge = model.matrix( ~discharge_disposition_id - 1,  data = data_subset)
names(discharge) = paste("discharge:", levels(data_subset$discharge_disposition_id))
head(discharge)
names(discharge)
discharge = as.data.frame(model.matrix( ~discharge_disposition_id - 1,  data = data_subset))
colnames(discharge) = paste("discharge:", levels(data_subset$discharge_disposition_id))
discharge = as.data.frame(model.matrix( ~discharge_disposition_id - 1,  data = data_subset))
names(discharge) = paste("discharge:", levels(data_subset$discharge_disposition_id))
head(discharge)
race = as.data.frame(model.matrix( ~race - 1,  data = data_subset))
race = as.data.frame(model.matrix( ~race - 1,  data = data_subset))
names(race) = paste("race:", levels(data_subset$race))
head(race)
data_subset$admission_source_id
admission = as.data.frame(model.matrix( ~admission_source_id - 1,  data = data_subset))
names(admission) = paste("admission:", levels(data_subset$admission_source_id))
specialty = as.data.frame(model.matrix( ~medical_specialty - 1,  data = data_subset))
names(specialty) = paste("specialty:", levels(data_subset$medical_specialty))
data_subset$time_in_hospital
specialty
specialty$`specialty: Cardiology`
class(specialty$`specialty: Cardiology`)
age = as.data.frame(model.matrix( ~age - 1,  data = data_subset))
names(age) = paste("age:", levels(data_subset$age))
data_subset = data[, c("readmitted", 'discharge_disposition_id','race' , "admission_source_id" , "medical_specialty" , "time_in_hospital" , "age" , "diag_1" , "A1Cresult", "age_num")]
diagnosis = as.data.frame(model.matrix( ~diag_1 - 1,  data = data_subset))
names(diagnosis) = paste("diagnosis:", levels(data_subset$diag_1))
A1Cresult = as.data.frame(model.matrix( ~A1Cresult - 1,  data = data_subset))
names(A1Cresult) = paste("A1Cresult:", levels(data_subset$A1Cresult))
age
specialty = as.data.frame(as.factor(model.matrix( ~medical_specialty - 1,  data = data_subset)))
specialty
cbind(discharge, race, admission, specialty, age, diagnosis, A1Cresult)
discharge = as.data.frame(model.matrix( ~discharge_disposition_id - 1,  data = data_subset))
names(discharge) = paste("discharge:", levels(data_subset$discharge_disposition_id))
race = as.data.frame(model.matrix( ~race - 1,  data = data_subset))
names(race) = paste("race:", levels(data_subset$race))
admission = as.data.frame(model.matrix( ~admission_source_id - 1,  data = data_subset))
names(admission) = paste("admission:", levels(data_subset$admission_source_id))
specialty = as.data.frame(model.matrix( ~medical_specialty - 1,  data = data_subset))
names(specialty) = paste("specialty:", levels(data_subset$medical_specialty))
age = as.data.frame(model.matrix( ~age - 1,  data = data_subset))
names(age) = paste("age:", levels(data_subset$age))
diagnosis = as.data.frame(model.matrix( ~diag_1 - 1,  data = data_subset))
names(diagnosis) = paste("diagnosis:", levels(data_subset$diag_1))
A1Cresult = as.data.frame(model.matrix( ~A1Cresult - 1,  data = data_subset))
names(A1Cresult) = paste("A1Cresult:", levels(data_subset$A1Cresult))
cbind(discharge, race, admission, specialty, age, diagnosis, A1Cresult)
data_factor[,1]
data_factor = cbind(discharge, race, admission, specialty, age, diagnosis, A1Cresult)
data_factor[,1]
as.factor(data_factor[,1])
factor(data_factor[,1], labels = c("no", "yes"))
data_factor[,1] = factor(data_factor[,1], labels = c("no", "yes"))
data_factor[,1]
data_factor
for(i in 1:ncol(data_factor)){
data_factor[,i] = factor(data_factor[,i], labels = c("no", "yes"))
}
data_factor
data_subset = cbind(data_factor, data_subset$time_in_hospital, data_subset$age_num)
data_subset
tree2 = classtree(data = data_subset, resp = "readmitted", min.obs = 100)
data_subset = data[, c("readmitted", 'discharge_disposition_id','race' , "admission_source_id" , "medical_specialty" , "time_in_hospital" , "age" , "diag_1" , "A1Cresult", "age_num")]
tree1 = classtree(data = data_subset, resp = "readmitted", min.obs = 100)
discharge = as.data.frame(model.matrix( ~discharge_disposition_id - 1,  data = data_subset))
names(discharge) = paste("discharge:", levels(data_subset$discharge_disposition_id))
race = as.data.frame(model.matrix( ~race - 1,  data = data_subset))
names(race) = paste("race:", levels(data_subset$race))
admission = as.data.frame(model.matrix( ~admission_source_id - 1,  data = data_subset))
names(admission) = paste("admission:", levels(data_subset$admission_source_id))
specialty = as.data.frame(model.matrix( ~medical_specialty - 1,  data = data_subset))
names(specialty) = paste("specialty:", levels(data_subset$medical_specialty))
age = as.data.frame(model.matrix( ~age - 1,  data = data_subset))
names(age) = paste("age:", levels(data_subset$age))
diagnosis = as.data.frame(model.matrix( ~diag_1 - 1,  data = data_subset))
names(diagnosis) = paste("diagnosis:", levels(data_subset$diag_1))
A1Cresult = as.data.frame(model.matrix( ~A1Cresult - 1,  data = data_subset))
names(A1Cresult) = paste("A1Cresult:", levels(data_subset$A1Cresult))
data_factor = cbind(discharge, race, admission, specialty, age, diagnosis, A1Cresult)
for(i in 1:ncol(data_factor)){
data_factor[,i] = factor(data_factor[,i], labels = c("no", "yes"))
}
data_subset = cbind(data_factor, data_subset$time_in_hospital, data_subset$age_num
data_subset = data[, c("readmitted", 'discharge_disposition_id','race' , "admission_source_id" , "medical_specialty" , "time_in_hospital" , "age" , "diag_1" , "A1Cresult", "age_num")]
data_subset = data[, c("readmitted", 'discharge_disposition_id','race' , "admission_source_id" , "medical_specialty" , "time_in_hospital" , "age" , "diag_1" , "A1Cresult", "age_num")]
discharge = as.data.frame(model.matrix( ~discharge_disposition_id - 1,  data = data_subset))
names(discharge) = paste("discharge:", levels(data_subset$discharge_disposition_id))
race = as.data.frame(model.matrix( ~race - 1,  data = data_subset))
names(race) = paste("race:", levels(data_subset$race))
admission = as.data.frame(model.matrix( ~admission_source_id - 1,  data = data_subset))
names(admission) = paste("admission:", levels(data_subset$admission_source_id))
specialty = as.data.frame(model.matrix( ~medical_specialty - 1,  data = data_subset))
names(specialty) = paste("specialty:", levels(data_subset$medical_specialty))
age = as.data.frame(model.matrix( ~age - 1,  data = data_subset))
names(age) = paste("age:", levels(data_subset$age))
diagnosis = as.data.frame(model.matrix( ~diag_1 - 1,  data = data_subset))
names(diagnosis) = paste("diagnosis:", levels(data_subset$diag_1))
A1Cresult = as.data.frame(model.matrix( ~A1Cresult - 1,  data = data_subset))
names(A1Cresult) = paste("A1Cresult:", levels(data_subset$A1Cresult))
data_factor = cbind(discharge, race, admission, specialty, age, diagnosis, A1Cresult)
for(i in 1:ncol(data_factor)){
data_factor[,i] = factor(data_factor[,i], labels = c("no", "yes"))
}
data_subset = cbind(data_factor, data_subset$time_in_hospital, data_subset$age_num, data_subset$readmitted)
tree2 = classtree(data = data_subset, resp = "readmitted", min.obs = 100)
data$age_num
data_subset
data_subset = cbind(data_factor, "time_in_hospital" = data_subset$time_in_hospital, "age_num" = data_subset$age_num, "readmitted" = data_subset$readmitted)
data_subset = data[, c("readmitted", 'discharge_disposition_id','race' , "admission_source_id" , "medical_specialty" , "time_in_hospital" , "age" , "diag_1" , "A1Cresult", "age_num")]
discharge = as.data.frame(model.matrix( ~discharge_disposition_id - 1,  data = data_subset))
names(discharge) = paste("discharge:", levels(data_subset$discharge_disposition_id))
race = as.data.frame(model.matrix( ~race - 1,  data = data_subset))
names(race) = paste("race:", levels(data_subset$race))
admission = as.data.frame(model.matrix( ~admission_source_id - 1,  data = data_subset))
names(admission) = paste("admission:", levels(data_subset$admission_source_id))
specialty = as.data.frame(model.matrix( ~medical_specialty - 1,  data = data_subset))
names(specialty) = paste("specialty:", levels(data_subset$medical_specialty))
age = as.data.frame(model.matrix( ~age - 1,  data = data_subset))
names(age) = paste("age:", levels(data_subset$age))
diagnosis = as.data.frame(model.matrix( ~diag_1 - 1,  data = data_subset))
names(diagnosis) = paste("diagnosis:", levels(data_subset$diag_1))
A1Cresult = as.data.frame(model.matrix( ~A1Cresult - 1,  data = data_subset))
names(A1Cresult) = paste("A1Cresult:", levels(data_subset$A1Cresult))
data_factor = cbind(discharge, race, admission, specialty, age, diagnosis, A1Cresult)
for(i in 1:ncol(data_factor)){
data_factor[,i] = factor(data_factor[,i], labels = c("no", "yes"))
}
data_subset = cbind(data_factor, "time_in_hospital" = data_subset$time_in_hospital, "age_num" = data_subset$age_num, "readmitted" = data_subset$readmitted)
tree2 = classtree(data = data_subset, resp = "readmitted", min.obs = 100)
tree2
data_subset = cbind(data_factor, "time_in_hospital" = data_subset$time_in_hospital, "readmitted" = data_subset$readmitted)
tree2 = classtree(data = data_subset, resp = "readmitted", min.obs = 100)
tree2
rpart(readmitted ~., data = data_subset, minsplit = 100, cp=-1)
rpart1 = rpart(readmitted ~., data = data_subset, minsplit = 100, cp=-1)
summary(rpart1
)
sort(tree2$var_rank, decreasing = TRUE)
sort(tree2$var_rank$criterion, decreasing = TRUE)
tree2$var_rank$criterion
tree2$var_rank
summary(rpart1)
tree2$output
rpart1
tree1$output
tree1$var_rank
tree2$var_rank
source("../class.R")
summary(rpart1)
?setwd
apply(data, MARGIN = 2, FUN = function(x){length(which(x) == "?")})
apply(data, MARGIN = 2, FUN = function(x){length(which(x == "?"))})
# working directory
setwd("~/../LX_Project/cart/diabetes/")
library(stringr)
library(ggplot2)
library(rpart)
source("../class.R") # load cart function
## read data:
data = read.csv(file = "diabetic_data.csv")
apply(data, MARGIN = 2, FUN = function(x){length(which(x == "?"))})
# tables:
rowsum(table(data$A1Cresult, data$readmitted))
# tables:
nrow(table(data$A1Cresult, data$readmitted))
# tables:
rowSums(table(data$A1Cresult, data$readmitted))
# tables:
rowSums(table(data$A1Cresult, data$readmitted))
table(data$A1Cresult)
table(data$A1Cresult, data$readmitted)
data = data[unique_id, ]
# delete encounter_id now
data$encounter_id <- NULL
# 2. remove patients that entered hospice or passed away after discharge
data = data[ -which(data$discharge_disposition_id %in% c(11, 13, 14, 19, 20, 21)), ]
# check missing data:
apply(data, MARGIN = 2, FUN = function(x){length(which(x == "?"))})
# 'medical_specialty', 'weight' and 'payer_code' have lots of missing data
# remove the variables 'weight' and 'payer_code'
data$weight <- NULL
data$payer_code <- NULL
nrow(data)
# 69973, which is 11 less than the value reported in the paper (69984)
# re-coding some of the variables:
data$readmitted = as.factor(ifelse(data$readmitted == "<30", "YES", "NO"))
data$A1Cresult = as.factor(ifelse(data$A1Cresult %in% c("Norm", ">7"), "Normal", ifelse(data$A1Cresult == "None", "None", ifelse(data$change == "Ch", "high_ch", "high_noch"))))
data$discharge_disposition_id = as.factor(ifelse(data$discharge_disposition_id == 1, "Home", "Other"))
data$admission_source_id = as.factor(ifelse(data$admission_source_id == 7, "Emergency", ifelse(data$admission_source_id %in% c(1,2), "Referral", "Other")))
data$medical_specialty <- replace(data$medical_specialty, data$medical_specialty == "Cardiology-Pediatric", "Cardiology")
data$medical_specialty <- replace(data$medical_specialty, data$medical_specialty == "Surgeon", "SurgicalSpecialty")
data$medical_specialty <- replace(data$medical_specialty, data$medical_specialty == "Surgery-Cardiovascular/Thoracic", "SurgicalSpecialty")
data$medical_specialty <- replace(data$medical_specialty, data$medical_specialty == "Surgery-Colon&Rectal", "SurgicalSpecialty")
data$medical_specialty <- replace(data$medical_specialty, data$medical_specialty == "Surgery-General", "SurgicalSpecialty")
data$medical_specialty <- replace(data$medical_specialty, data$medical_specialty == "Surgery-Maxillofacial", "SurgicalSpecialty")
data$medical_specialty <- replace(data$medical_specialty, data$medical_specialty == "Surgery-Neuro", "SurgicalSpecialty")
data$medical_specialty <- replace(data$medical_specialty, data$medical_specialty == "Surgery-Pediatric", "SurgicalSpecialty")
data$medical_specialty <- replace(data$medical_specialty, data$medical_specialty == "Surgery-Plastic", "SurgicalSpecialty")
data$medical_specialty <- replace(data$medical_specialty, data$medical_specialty == "Surgery-PlasticwithinHeadandNeck", "SurgicalSpecialty")
data$medical_specialty <- replace(data$medical_specialty, data$medical_specialty == "Surgery-Thoracic", "SurgicalSpecialty")
data$medical_specialty <- replace(data$medical_specialty, data$medical_specialty == "Surgery-Vascular", "SurgicalSpecialty")
data$medical_specialty <- str_replace(data$medical_specialty, "SurgicalSpecialty", "Surgery")
data$medical_specialty[which(data$medical_specialty == "?")] = "Missing or Unknown"
data$medical_specialty[which(!(data$medical_specialty %in% c("InternalMedicine", "Cardiology", "Surgery", "Family/GeneralPractice", "Missing or Unknown")))] = "Other"
diag_diabetes = levels(data$diag_1)[which(substr(levels(data$diag_1), 1, 3)==250)]
diag_other = levels(data$diag_1)[which(!(levels(data$diag_1) %in% c(390:459, 785, diag_diabetes, 460:519, 786, 520:579, 787, 800:999, 710:739, 580:629, 788, 140:239)))]
levels(data$diag_1) <- list(
"Circulatory" = c(390:459, 785),
"Diabetes" = diag_diabetes,
"Respiratory" = c(460:519, 786),
"Digestive" = c(520:579, 787),
"Injury and poisoning" = c(800:999),
"Musculoskeletal" = c(710:739),
"Genitourinary" = c(580:629, 788),
"Neoplasms" = c(140:239),
"Other" = diag_other
)
levels(data$race) = list("Missing" = "?", "Other" = c("Other", "Asian", "Hispanic"), "African American" = "AfricanAmerican", "Caucasian" = "Caucasian" )
data$age_num = data$age
levels(data$age_num) = list("5" = "[0-10)", "15" = "[10-20)", "25" = "[20-30)", "35" = "[30-40)", "45" = "[40-50)", "55" = "[50-60)", "65" = "[60-70)", "75" = "[70-80)", "85" = "[80-90)", "95" = "[90-100)")
data$age_num = as.numeric(as.character(data$age_num))
levels(data$age) = list("< 30" = c("[0-10)", "[10-20)", "[20-30)" ), "[30, 60)" = c("[30-40)", "[40-50)", "[50-60)"), "[60, 100) " = c("[60-70)", "[70-80)", "[80-90)", "[90-100)"))
data$medical_specialty <- as.factor(data$medical_specialty)
data$medical_specialty <-droplevels(data$medical_specialty)
# change the baseline level for some factors:
data$race = relevel(data$race, ref = "African American")
data$age = relevel(data$age, ref = "[30, 60)")
data$diag_1 = relevel(data$diag_1, ref = "Diabetes")
data$A1Cresult =  relevel(data$A1Cresult, ref = "None")
table(data$A1Cresult)
# tables:
cbind(table(data$A1Cresult),table(data$A1Cresult, data$readmitted))
# tables:
cbind(table(data$A1Cresult),(table(data$A1Cresult, data$readmitted)[, 1])/nrow(data))
table(data$A1Cresult, data$readmitted)
590/6637
# tables:
cbind(table(data$A1Cresult),(table(data$A1Cresult))/nrow(data))
# tables:
cbind(table(data$A1Cresult),(table(data$A1Cresult))/nrow(data), table(data$A1Cresult, data$readmitted)[, 2], table(data$A1Cresult, data$readmitted)[, 1]/nrow(data) )
# tables:
cbind("HbA1c", table(data$A1Cresult),(table(data$A1Cresult))/nrow(data), table(data$A1Cresult, data$readmitted)[, 2], table(data$A1Cresult, data$readmitted)[, 1]/nrow(data) )
# tables:
data.frame(table(data$A1Cresult),(table(data$A1Cresult))/nrow(data), table(data$A1Cresult, data$readmitted)[, 2], table(data$A1Cresult, data$readmitted)[, 1]/nrow(data) )
# tables:
data.frame("# of encounters" = table(data$A1Cresult), "% of population" = (table(data$A1Cresult))/nrow(data), table(data$A1Cresult, data$readmitted)[, 2], table(data$A1Cresult, data$readmitted)[, 1]/nrow(data))
table(data$A1Cresult)
(table(data$A1Cresult))/nrow(data)
table(data$A1Cresult, data$readmitted)[, 2]
data.frame(table(data$A1Cresult),  (table(data$A1Cresult))/nrow(data), table(data$A1Cresult, data$readmitted)[, 2], table(data$A1Cresult, data$readmitted)[, 1]/nrow(data))
table(data$A1Cresult)
(table(data$A1Cresult))/nrow(data)
table(data$A1Cresult
data$readmitted)[, 2]
table(data$A1Cresult, data$readmitted)[, 2]
table(data$A1Cresult
table(data$A1Cresult, data$readmitted)[, 1]/nrow(data)
data.frame(table(data$A1Cresult),  (table(data$A1Cresult))/nrow(data), table(data$A1Cresult, data$readmitted)[, 2], table(data$A1Cresult, data$readmitted)[, 1]/nrow(data))
data.frame(table(data$A1Cresult)[,1],  (table(data$A1Cresult))/nrow(data), table(data$A1Cresult, data$readmitted)[, 2], table(data$A1Cresult, data$readmitted)[, 1]/nrow(data))
table(data$A1Cresult)[,1]
data.frame(table(data$A1Cresult),  (table(data$A1Cresult))/nrow(data), table(data$A1Cresult, data$readmitted)[, 2], table(data$A1Cresult, data$readmitted)[, 1]/nrow(data), row.names = levels(data$A1Cresult))
table(data$A1Cresult)
table(data$A1Cresult)[1,]
cbind(table(data$A1Cresult),  (table(data$A1Cresult))/nrow(data), table(data$A1Cresult, data$readmitted)[, 2], table(data$A1Cresult, data$readmitted)[, 1]/nrow(data))
as.data.frame(cbind(table(data$A1Cresult),  (table(data$A1Cresult))/nrow(data), table(data$A1Cresult, data$readmitted)[, 2], table(data$A1Cresult, data$readmitted)[, 1]/nrow(data)))
as.data.frame(cbind("HbA1c", table(data$A1Cresult),  (table(data$A1Cresult))/nrow(data), table(data$A1Cresult, data$readmitted)[, 2], table(data$A1Cresult, data$readmitted)[, 1]/nrow(data)))
